<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">
<Configure id="Server" class="org.eclipse.jetty.server.Server">
	<!-- https://eclipse.dev/jetty/javadoc/jetty-11/org/eclipse/jetty/util/thread/QueuedThreadPool.html -->
	<Get name="ThreadPool">
		<Set name="daemon">false</Set>
 		<Set name="detailedDump">false</Set>
		<!-- Set the maximum thread idle time in ms. -->
		<Set name="idleTimeout" type="int">120000</Set>
		<Set name="lowThreadsThreshold" type="int">10</Set>
		<!-- Returns the maximum number of idle threads that are evicted for every idle timeout period, thus shrinking this thread pool towards its minimum number of threads. -->
 		<Set name="maxEvictCount" type="int">1</Set>	
		<Set name="minThreads" type="int">10</Set>
		<Set name="maxThreads" type="int">200</Set>
		<!-- Sets the name of this thread pool, used as a prefix for the thread names. -->
		<Set name="name" type="String">ThreadPool</Set>
		<Set name="reservedThreads" type="int">-1</Set>
 		<Set name="stopTimeout" type="long">5000</Set>
 		<Set name="threadsPriority" type="int">1</Set>
	</Get>
	<!-- https://eclipse.dev/jetty/javadoc/jetty-11/org/eclipse/jetty/server/HttpConfiguration.html -->
	<New id="httpConfig" class="org.eclipse.jetty.server.HttpConfiguration">
		<Set name="outputBufferSize">32768</Set>
		<Set name="requestHeaderSize">8192</Set>
		<Set name="responseHeaderSize">8192</Set>
		<Set name="sendServerVersion">true</Set>
		<Set name="sendDateHeader">false</Set>
		<Set name="headerCacheSize">512</Set>
		<Set name="persistentConnectionsEnabled">true</Set>
	</New>
	<Call name="addConnector">
		<Arg>
			<!-- https://eclipse.dev/jetty/javadoc/jetty-11/org/eclipse/jetty/server/ServerConnector.html -->
			<New class="org.eclipse.jetty.server.ServerConnector">
				<Arg name="server">
					<Ref refid="Server" />
				</Arg>
				<Arg name="acceptors" type="int">-1</Arg>
				<Arg name="selectors" type="int">-1</Arg>
				<Arg name="factories">
					<Array type="org.eclipse.jetty.server.ConnectionFactory">
						<Item>
							<New class="org.eclipse.jetty.server.HttpConnectionFactory">
								<Arg name="config">
									<Ref refid="httpConfig" />
								</Arg>
							</New>
						</Item>
						<Item>
							<New class="org.eclipse.jetty.http2.server.HTTP2ServerConnectionFactory">
								<Arg name="config">
									<Ref refid="httpConfig" />
								</Arg>
								<Set name="maxConcurrentStreams" type="int">1024</Set>
							</New>
						</Item>
					</Array>
				</Arg>
				<Set name="host">0.0.0.0</Set>
				<Set name="port">8486</Set>
				<Set name="idleTimeout">30000</Set>				
				<Set name="acceptorPriorityDelta">0</Set>
				<Set name="acceptedReceiveBufferSize" type="int">32768</Set>
				<Set name="acceptedSendBufferSize" type="int">32768</Set>
				<Set name="acceptedTcpNoDelay">true</Set>
				<Set name="accepting">true</Set>
				<Set name="acceptQueueSize" type="int">-1</Set>
				<!-- Sets whether this connector uses a channel inherited from the JVM. -->
				<Set name="inheritChannel">false</Set>
				<Set name="reuseAddress">true</Set>
				<Set name="reusePort">true</Set>
				<Get name="SelectorManager">
				  <Set name="connectTimeout">15000</Set>
				</Get>
			</New>
		</Arg>
	</Call>
	<Set name="stopAtShutdown">true</Set>
	<Set name="dumpAfterStart">false</Set>
	<Set name="dumpBeforeStop">false</Set>
</Configure>
